{% for post in posts recursive %}
    <div class="post" style="margin-left: {{ loop.depth0 * 20 }}px;">
        <div class="meta">ğŸ‘¤ {{ post.user }}ï½œ {{ post.time_ago }}</div>
        <div class="content">{{ post.content | nl2br }}</div>

        {% if post.image %}
            <img src="{{ url_for('uploaded_file', filename=post.image) }}"
                 style="max-width:100%; border-radius:8px; margin-top:8px;">
        {% endif %}

        <div class="actions">
            <a href="#" onclick="showReplyForm({{ post.id }}); return false;">å›è¦†</a>
            {% if post.user == user %}
                <a href="/edit/{{ post.id }}">ç·¨è¼¯</a>
                <a href="#" onclick="deletePost({{ post.id }}); return false;">åˆªé™¤</a>
            {% endif %}
        </div>

        <!-- âœ… å›è¦†è¡¨å–®ï¼ˆéš±è—ï¼‰ -->
        <form method="POST" enctype="multipart/form-data" class="reply-form" id="reply-form-{{ post.id }}" style="display:none; margin-top:10px;">
            <input type="hidden" name="parent_id" value="{{ post.id }}">
            <textarea name="content" rows="2" placeholder="å›è¦†å…§å®¹..." required></textarea><br>
            <input type="file" name="image" accept="image/*"><br>
            <button type="button" onclick="submitReply({{ post.id }})">é€å‡ºå›è¦†</button>
            <button type="button" onclick="clearReplyForm({{ post.id }})">clear</button>
        </form>

        {% if post.replies %}
            {{ loop(post.replies) }}
        {% endif %}
    </div>
{% endfor %}
